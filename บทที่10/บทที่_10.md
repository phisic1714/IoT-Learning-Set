# บทที่ 1 ทำความคุ้นเคยกับ Tool, หลอดไฟ LED, LED 7-Segment(Datasheet), การคำนวณ R อนุกรม

No. |ชื่อเรื่อง|
----- |----- |
1)|[ESP8266]()|
2)|[PlatformIO]()|
3)|[Serial Monitor]()|
4)|[State Machine]()|
5)|[LED ไฟกระพริบ (ภายใน ภายนอก) ด้วย State machine]()|
6)|[ตัวต้านทาน]()|
7)|[การคำนวณ LED และตัวต้านทาน (R)]()|
8)|[LED 7-Segment]()|

-----
### **ESP8266** ข้อมูลทั่วไป, การใช้งาน
*NodeMCU ESP8266* คือไมโครคอนโทรลเลอร์แบบ SoC (System on Chip) เป็นการรวมการทำงานทั้งหมดที่จำเป็นอยู่ที่ชิปเดียว มี WiFi ในการเชื่อมต่อกับอินเตอร์เน็ตได้ โดยส่วนประกอบหลัก ๆ ที่เราใช้และหน้าที่ขาแต่ละขาบน NodeMCU ESP8266 มีดังนี้
-	ขา **GPIO** (General Purpose Input/Output) สำหรับเชื่อมต่อและกำหนดสัญญาณข้อมูลอินพุตหรือเอาต์พุตอุปกรณ์ภายนอกอื่นด้วยสัญญาณดิจิตอล
-	ขา **ADC** (Analog-to-Digital Converter) ทำหน้าที่แปลงสัญญาณอะนาล็อก คือ ขา A0 
-	ขา **VCC** (Common Collector Voltage) เป็นขาที่รับแหล่งจ่ายไฟเข้ามา ประกอบไปด้วยขา 3.3 โวลต์ และ 5 โวลต์
-	ขา **SPI** สำหรับทำงานร่วมกับ SD Card
-	ขา **I2C** สำหรับรองรับอุปกรณ์ที่ทำงานแบบ I2C โดยควบคุมได้ผ่าน SDA และ SCL
-	ขา **GND** กราวด์

/ภาพ ESP8266/

### **PlatformIO** ข้อมูลทั่วไป, การใช้งาน
*PlatformIO* เป็นซอฟต์แวร์แบบ Open Source ใช้พัฒนาระบบฝังตัวหรือระบบ IoT แบบข้ามแพลตฟอร์มได้ ผ่านบอร์ดไมโครคอนโทรลเลอร์ต่างๆ ที่เกี่ยวข้อง เช่น ESP8266, ESP32 เป็นต้น สำหรับการติดตั้ง ต้องมีโปรแกรม Visual Studio Code (VS Code) ก่อนถึงสามารถติดตั้ง PlatformIO ได้ เนื่องจาก PlatformIO เป็นหนึ่งใน Extension ของ VS Code

### **Serial Monitor**
โดย *Serial Monitor* เป็นส่วนหนึ่งที่ใช้ในการติดต่อสื่อสารของผู้ใช้ระหว่างอุปกรณ์คอมพิวเตอร์กับ NodeMCU ESP8266 ให้แสดงข้อมูลออกผ่านหน้าจอคอมพิวเตอร์ สำหรับการใช้งาน Serial Monitor จะต้องใช้ผ่าน PlatformIO ใน VS Code โดยมีการใช้งาน ดังนี้
#### การใช้งาน Serial Monitor
//มีแปะรูปตามขั้นตอนนี้ทั้งหมด (1-7)

    1)	เปิดหน้า VS Code ไปที่ Extension PlatformIO
    2)	คลิกเมนู Device เพื่อตรวจสอบการเชื่อมต่อของอุปกรณ์
    3)	คลิกเมนู Home เลือก New Project
    4)	กำหนด Project เบื้องต้น (ในที่นี้ตั้งชื่อ 1_SerialMonitor)
    5)	กำหนด baud rate ให้เท่ากันระหว่างไฟล์ platformio.ini กับ main.cpp คือ ไฟล์ platformio.ini
        ให้กำหนดค่า monitor_speed ซึ่งเป็นค่า baud rate ที่เราต้องการ และเช่นเดียวกับในไฟล์ main.cpp มีกำหนดด้วยคำสั่ง Serial.begin(baud rate ที่กำหนด) เพื่อให้สามารถใช้งาน Serial Monitor ได้
    6)	จากนั้นกด Upload
    7)	กด Serial Monitor เพื่อดูผลลัพธ์

<details><summary>CLICK : <ins>ตัวอย่างที่ 1.1 การแสดงข้อความบน Serial monitor</ins></summary>
<p>

```ruby
#include <Arduino.h> //เรียกใช้งาน Library Ardunio
void setup()
{
    Serial.begin(152000); //การตั้งค่า Baud rate เพื่อเปิดใช้งาน Serial Monitor
}
void loop()
{
    Serial.println("Hello World"); //คำสั่งแสดงข้อความ "Hello World" บน Serial Monitor
}
```
<p>
</details>

<details><summary>CLICK : <ins>ตัวอย่างที่ 1.2 การพิมพ์ข้อความบน Serial Monitor</ins></summary>
<p>

```ruby
#include <Arduino.h>
void setup()
{
    Serial.begin(152000);
}
void loop()
{
    Serial.println("Input : ");
    while(!Serial.available()){} //เมื่อไม่มีการพิมพ์ใดๆ บน Serial Monitor จะทำงานใน Loop นี้
    String input = Serial.readString(); //อ่านค่า String จากการพิมพ์ผ่าน Serial Monitor โดยเก็บค่าที่อ่านได้ไว้ในตัวแปร input
    Serial.println(input);
}
```
<p>
</details>

### **State Machine**
*State Machine* คือ การกำหนดสถานะการทำงาน มีส่วนช่วยในการออกแบบโปรแกรมคอมพิวเตอร์หรือระบบฮาร์ดแวร์ ให้สามารถควบคุมการทำงานของระบบได้เป็นไปตามลำดับเหตุการณ์ โดยการทำงานของ State Machine จะเริ่มต้นจากการรับข้อมูลอินพุตเข้ามาแล้วจะเปลี่ยนสถานะของการทำงานของตัวระบบตามที่เรากำหนดไว้

//แปะรูป State Machine

จากภาพตัวอย่างการทำงาน เปิด-ปิด LED Built-in แบบ State Machine มีการเริ่มต้นจากสถานะ LED_LOW ทำให้ LED Built-in ไฟสว่าง จากนั้นรอเวลา 1 วินาที แล้วเปลี่ยนสถานะ LED_HIGH ทำให้ LED Built-in ไฟดับ  

#### การออกแบบ State Machine เขียน code
ส่วนประกอบที่สำคัญ ได้แก่
    1. ชื่อสถานะ กำหนดชื่อทุกสถานะตามการทำงานที่ออกแบบ โดยสถานะเริ่มต้นจะสำคัญที่สุด
    2. เหตุการณ์ที่เกิดขึ้น อธิบายการทำงานของเหตุการณ์ที่เกิดขึ้นในแต่ละสถานะ
    3. เงื่อนไขในการเปลี่ยนสถานะ คือ การระบุการกระทำ หรือเหตุการณ์ที่ทำให้เปลี่ยนสถานะ เหตุการณ์ทำงาน เช่น กดปุ่มสวิตช์เพื่อเปลี่ยนโหมด เป็นต้น 

### **LED ไฟกระพริบ โดยใช้ State Machine**
สำหรับ LED ที่นำมาทดลองในบทนี้ มี LED Built-in ที่อยู่บนบอร์ด ESP8266 และ LED ภายนอก ที่เป็นการต่อวงจรแยกต่างหากจากบอร์ด มีกำหนดการทำงานให้ไฟกระพริบในรูปแบบ State Machine

<details><summary>CLICK : <ins>ตัวอย่างที่ 1.3 การกำหนดการทำงานไฟกระพริบของ LED Built-in</ins></summary>
<p>

```ruby
#include <Arduino.h>
const int LED_LOW=0; //ประกาศตัวแปรสถานะ LED_LOW สถานะที่ 0
const int LED_HIGH=1; //ประกาศตัวแปรสถานะ LED_HIGH สถานะที่ 1
int state; //ประกาศตัวแปรเก็บสถานะ
void setup()
{
    state = LED_LOW; //เก็บสถานะเริ่มต้นเป็น LED_LOW ลงไปในตัวแปร state
    pinMode(LED_BUILTIN, OUTPUT); //ประกาศขาในการทำงานโดย LED_BUILTIN เป็น OUTPUT
}
void loop()
{
    //การทำงานสถานะ LED_LOW
    if(state==LED_LOW){ //ตั้งเงื่อนไขถ้าค่าตัวแปร state เท่ากับค่าตัวแปร LED_LOW
        digitalWrite(LED_BUILTIN, HIGH); //กำหนด LED_BUILTIN ดับ
        delay(1000); //รอเวลา 1000 มิลลิวินาทีหรือ 1 วินาที
        state = LED_HIGH; //เปลี่ยนค่าตัวแปร state เป็น = LED_HIGH
    }
    //การทำงานสถานะ LED_HIGH
    else if(state==LED_HIGH){ //เงื่อนไขถ้าค่าตัวแปร state เท่ากับค่าตัวแปร LED_HIGH
        digitalWrite(LED_BUILTIN, LOW); //กำหนด LED_BUILTIN สว่าง
        delay(1000); //รอเวลา 1000 มิลลิวินาทีหรือ 1 นาที
        state = LED_LOW; //เปลี่ยนค่าตัวแปร state เป็น = LED_LOW
    }
}
```
<p>
</details>

<details><summary>CLICK : <ins>ตัวอย่างที่ 1.4 การกำหนดการทำงานไฟกระพริบของ LED ภายนอก</ins></summary>
<p>

```ruby
#include <Arduino.h>
const int LED_LOW=0; //ประกาศตัวแปรสถานะ LED_LOW สถานะที่ 0
const int LED_HIGH=1; //ประกาศตัวแปรสถานะ LED_HIGH สถานะที่ 1
int state; //ประกาศตัวแปรเก็บสถานะ
void setup()
{
    state = LED_LOW; //เก็บสถานะเริ่มต้นเป็น LED_LOW ลงไปในตัวแปร state
    pinMode(LED_BUILTIN, OUTPUT); //ประกาศขาในการทำงานโดย LED_BUILTIN เป็น OUTPUT
}
void loop()
{
    //การทำงานสถานะ LED_LOW
    if(state==LED_LOW){ //ตั้งเงื่อนไขถ้าค่าตัวแปร state เท่ากับค่าตัวแปร LED_LOW
        digitalWrite(LED_BUILTIN, HIGH); //กำหนด LED_BUILTIN ดับ
        delay(1000); //รอเวลา 1000 มิลลิวินาทีหรือ 1 วินาที
        state = LED_HIGH; //เปลี่ยนค่าตัวแปร state เป็น = LED_HIGH
    }
    //การทำงานสถานะ LED_HIGH
    else if(state==LED_HIGH){ //เงื่อนไขถ้าค่าตัวแปร state เท่ากับค่าตัวแปร LED_HIGH
        digitalWrite(LED_BUILTIN, LOW); //กำหนด LED_BUILTIN สว่าง
        delay(1000); //รอเวลา 1000 มิลลิวินาทีหรือ 1 นาที
        state = LED_LOW; //เปลี่ยนค่าตัวแปร state เป็น = LED_LOW
    }
}
```
<p>
</details>